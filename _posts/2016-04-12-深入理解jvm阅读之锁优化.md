---
layout: post
title: 深入理解jvm阅读之锁优化
category: [JAVA,JVM,图书/感想]
tags: [JAVA,JVM,图书]
---

### 锁优化

* 1.自旋锁与自适应自旋(动态自旋),为了避免线程上下切换照成的资源浪费,使用不断循环当前线程(能否获取锁)避免切换线程的资源浪费,这种不断循环的过程称为自旋,主要在非阻塞锁中用到.自旋次数是有限的,默认10次可以通过```-XX: PreBlockSpin```设置

自适应自旋: 如果这个自旋等待刚刚成功获取过锁,那么再次获取的可能性很大,那么jvm将会允许他进行更长时间的自旋来获得锁,如果对于某个锁,自旋很少成功,那么jvm以后会减少自旋次数,甚至忽略掉自旋的过程

* 2.锁消除: 编译器在运行时发现一些同步操作中的锁不存储数据共享,线程竞争的问题,那么就会把锁剔除,例如一个方法中有一个同步代码块,操作一个变量,而这个变量的作用域只存在于这个方法中,该类的其他方法没有获得这个变量的途径,因此可以将锁消除

* 3.锁粗化: 当jvm探测到程序在对一个对象不停的重复加锁,造成资源浪费,那么回跳出循环,在循环之外加锁,扩大加锁的范围

* 4.轻量级锁: 在没有竞争的情况下,通过cas操作更改对象头数据,来完成同步过程,如果有竞争存在,那么操作失败,并且还因为执行了cas操作.而比重锁更慢

* 5.偏向锁: 轻量锁是在无竞争的情况下使用cas操作消除同步互斥,那么偏向锁是在无竞争环境下消除整个同步操作,连cas都不做了.偏向于第一个获得他的线程,如果在后面的操作中,该锁没有被其他线程尝试获取,那么获得该锁的线程将不用做同步操作,当有另外一个线程尝试去获取偏向锁,那么偏向就不存在了